//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by source generator
//
//     Changes to this file may cause incorrect behavior and will be lost if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#nullable enable

using GymDdd.Framework.BaseTypes;
using System.Diagnostics;
using System.Diagnostics.CodeAnalysis;
using System.Text.Json;
using System.Text.Json.Serialization;

namespace MyNamespace;

[DebuggerDisplay("{Value}")]
[JsonConverter(typeof(ProductIdJsonConverter))]
public readonly record struct ProductId : IEntityId<ProductId>, IParsable<ProductId>
{
    public const string Name = "ProductId";
    public const string Namespace = "MyNamespace";

    private ProductId(Ulid id)
    {
        Value = id;
    }

    public readonly Ulid Value { get; init; }

    public static ProductId New()
    {
        return new ProductId(Ulid.NewUlid());
    }

    public static ProductId Create(Ulid id)
    {
        return new ProductId(id);
    }

    public static ProductId Create(string id)
    {
        if (Ulid.TryParse(id, out var ulid))
        {
            return Create(ulid);
        }

        throw new InvalidOperationException($"'{id}' cannot be parsed to Ulid");
    }

    // record struct는 자동으로 Value 기반의 Equals/GetHashCode()를 생성합니다
    //public override int GetHashCode()
    //{
    //    return Value.GetHashCode();
    //}

    public override string ToString()
    {
        return Value.ToString();
    }

    public int CompareTo(IEntityId? other)
    {
        if (other is null)
        {
            return 1;
        }

        if (other is not ProductId otherId)
        {
            throw new ArgumentException($"other must be of type {typeof(UserId)}, but was {other.GetType()}");
        }

        return Value.CompareTo(otherId.Value);
    }

    public static ProductId Parse(string entityIdAsString, IFormatProvider? provider)
    {
        return Create(entityIdAsString);
    }

    public static bool TryParse([NotNullWhen(true)] string? entityIdAsString, IFormatProvider? provider, [MaybeNullWhen(false)] out ProductId result)
    {
        if (entityIdAsString is null)
        {
            result = default;
            return false;
        }

        result = Create(entityIdAsString);
        return true;
    }

    public static bool operator >(ProductId a, ProductId b) => a.CompareTo(b) is 1;
    public static bool operator <(ProductId a, ProductId b) => a.CompareTo(b) is -1;
    public static bool operator >=(ProductId a, ProductId b) => a.CompareTo(b) >= 0;
    public static bool operator <=(ProductId a, ProductId b) => a.CompareTo(b) <= 0;
}

public sealed class ProductIdJsonConverter : JsonConverter<ProductId>
{
    public override ProductId Read(ref Utf8JsonReader reader, Type typeToConvert, JsonSerializerOptions options)
    {
        var entityIdAsString = reader.GetString();

        if (string.IsNullOrWhiteSpace(entityIdAsString))
        {
            throw new JsonException("The UserId string is null or empty.");
        }

        if (Ulid.TryParse(entityIdAsString, out var ulid))
        {
            return ProductId.Create(ulid);
        }

        throw new InvalidOperationException($"'{entityIdAsString}' cannot be parsed to Ulid");
    }

    public override void Write(Utf8JsonWriter writer, ProductId entityId, JsonSerializerOptions options)
    {
        writer.WriteStringValue(entityId.Value.ToString());
    }
}
